{% extends "./layout.twig" %}

{% block head %}
<title>Analytics</title>
<link rel="stylesheet" href="/CSS/analytics.css"/>
<script>
  window.addEventListener('load', function (e) {
    var acc = document.getElementsByClassName("accordion");
    var i;

    for (i = 0; i < acc.length; i++) {
      acc[i].addEventListener("click", function() {
        /* Toggle between adding and removing the "active" class,
        to highlight the button that controls the panel */
        this.classList.toggle("active");

        /* Toggle between hiding and showing the active panel */
        var panel = this.nextElementSibling;
        if (panel.style.display === 'none') {
          panel.style.display = null;
        } else {
          panel.style.display = "none";
        }
      });
    }
  });
</script>
{% endblock %}

{% block body %}
<main>

  {% for data in datas %}
    <div class="accordion">
      <span>Query: <i>"{{ data.request.result.query }}"</i></span>
      <span>Intent: {{ data.result.response.intent }}</span>
      <span>Confidence: {{ data.result.confidence }}</span>
      <span>Date: {{ data.date|prettydate }}</span>
    </div>
    <div class="panel" style="display: none">
      <div class="accordion">
        Request
      </div>
      <div class="panel request" style="display: none">
        <div>
          <span>Types : {{ data.request.acceptedtypes|join(', ') }}</span>
          <span>Lang : {{ data.request.lang }}</span>
          <span>Response : {{ data.request.result.response ?? 'none' }}</span>
        </div>
        <div>
          <span>Intents:</span><br>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Confidence</th>
              </tr>
            </thead>
            <tbody>
              {% for i in data.request.result.intents %}
                <tr>
                  <td>{{ i.name }}</td>
                  <td>{{ i.confidence }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div>
          <span>Entities:</span><br>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              {% for i in data.request.result.entities %}
                <tr>
                  <td>{{ i.name }}</td>
                  <td>{{ i.value }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="accordion">
        Intent response
      </div>
      <div class="panel" style="display: none">
      <pre>{{ data.parsedResponse.responses|prettyjson }}</pre>
      </div>
      <div class="accordion">
        Oter intents
      </div>
      <div class="panel" style="display: none">
        <div>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Confidence</th>
              </tr>
            </thead>
            <tbody>
              {% for i in data.results %}
                <tr>
                  <td>{{ i.response.intent }}</td>
                  <td>{{ i.confidence }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="accordion">
        Before Contexts
      </div>
      <div class="panel" style="display: none">
        <pre>{{ data.request.result.contexts|prettyjson }}</pre>
      </div>
      <div class="accordion">
        After Contexts
      </div>
      <div class="panel" style="display: none">
        <pre>{{ data.result.contexts|prettyjson }}</pre>
      </div>

    </div>
  {% endfor %}

</main>
{% endblock %}
